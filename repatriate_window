#!/usr/bin/env bash

set -euo pipefail

usage() {
    echo "Usage: repatriate_windows [-a]"
    echo "-a    Send every window with a default workspace to its default workspace"
    echo "      If omitted, only the currently focused window is sent to its defauls workspace, if it has one."
}

all=false

while getopts 'a' opt; do
    case "${opt}" in
        a) all=true ;;
        *) usage >&2; exit 1;;
    esac
done

windows=()

if $all; then
    readarray -t windows < <(aerospace list-windows --all --format "%{app-name},%{window-id}")
else
    readarray -t windows < <(aerospace list-windows --focused --format "%{app-name},%{window-id}")
fi

move_it() {
    aerospace move-node-to-workspace --window-id "$1" "$2" 2>/dev/null
}

for window in "${windows[@]}"; do
    IFS=',' read -r app_name window_id <<< "$window"
    case "$app_name" in
        WezTerm)
            move_it "$window_id" 1 ;;
        "Google Chrome")
            move_it "$window_id" 2 ;;
        Obsidian)
            move_it "$window_id" 3 ;;
        Zathura)
            move_it "$window_id" 4 ;;
        *)
            move_it "$window_id" 5 ;;
    esac
done
