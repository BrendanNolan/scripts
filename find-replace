#! /usr/bin/env fish

function print_find_replace_help_message
    echo 'Usage:'
    echo '    find_replace -f <search text> -r <replacement text> -p <path> [--regex]'
    echo 'By default your search string will be used as a literal. If you want it to be used as a regex, pass the --regex flag.'
    exit 0
end

function find_replace
    argparse 'h/help' 'f/find=' 'r/replace=' 'p/path=?' 'regex' -- $argv
    if set -q _flag_help
        print_find_replace_help_message
        exit 0
    end
    set -l path .
    if set -q _flag_path
        set path $_flag_path
    end 
    if set -q _flag_regex
        fd --type file . "$_flag_path" --exec sd "$_flag_find" "$_flag_replace"
    else
        fd --type file . "$_flag_path" --exec sd --fixed-string "$_flag_find" "$_flag_replace"
    end
end

find_replace $argv
