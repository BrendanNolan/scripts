#!/usr/bin/env fish

function find_replace
    argparse 'h/help' 'f/find=' 'r/replace=' 'p/path=?' -- $argv

    if set -q _flag_help
        echo 'Usage: find_replace -f <search text> -r <replacement text> -p <path>'
        exit 0
    end

    if set -q _flag_path
        set -l path $_flag_path
    else
        set -l path .
    end

    switch (uname)
        case Darwin # macOS
            rg -l $_flag_find $path | xargs gsed -i "s@$_flag_find@$_flag_replace@g"
        case Linux
            rg -l $_flag_find $path | xargs sed -i "s@$_flag_find@$_flag_replace@g"
        case '*'
            echo 'You seem to be neither on macOS nor on Linux. Exiting.'
    end
end

find_replace $argv
